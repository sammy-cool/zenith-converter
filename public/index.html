<!DOCTYPE html>
<html lang="en">
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  <head>
    <title>Zenith V3 Enterprise</title>
    <style>
      :root {
        --primary: #58a6ff;
        --bg: #0d1117;
        --card: #161b22;
      }
      body {
        font-family: "Segoe UI", sans-serif;
        background: var(--bg);
        color: #c9d1d9;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        margin: 0;
      }
      .card {
        background: var(--card);
        border: 1px solid #30363d;
        padding: 30px;
        border-radius: 12px;
        width: 500px;
      }
      .logo-container {
        text-align: center;
        margin-bottom: 25px;
      }
      .app-logo {
        width: 220px; /* Adjust size as needed */
        height: auto;
        filter: drop-shadow(0 0 10px rgba(88, 166, 255, 0.3));
        transition: transform 0.3s ease;
      }
      .app-logo:hover {
        transform: scale(1.02);
      }
      .upload-zone {
        border: 2px dashed #444;
        padding: 40px;
        text-align: center;
        border-radius: 10px;
        cursor: pointer;
        margin: 20px 0;
        transition: 0.3s;
      }
      .upload-zone:hover {
        border-color: var(--primary);
        background: #1c2128;
      }
      .progress-box {
        margin-top: 20px;
        display: none;
      }
      .bar-outer {
        background: #30363d;
        height: 12px;
        border-radius: 10px;
        overflow: hidden;
      }
      .bar-inner {
        background: #238636;
        width: 0%;
        height: 100%;
        transition: 0.3s;
        box-shadow: 0 0 10px #238636;
      }
      .console {
        background: #000;
        color: #0f0;
        font-family: monospace;
        font-size: 11px;
        padding: 15px;
        border-radius: 5px;
        height: 100px;
        overflow-y: auto;
        margin-top: 15px;
        border: 1px solid #333;
      }
      button {
        background: #238636;
        color: white;
        border: none;
        padding: 15px;
        width: 100%;
        border-radius: 6px;
        font-weight: bold;
        cursor: pointer;
      }
      button:disabled {
        background: #21262d;
        color: #484f58;
      }
      #downloadBtn {
        background: var(--primary);
        display: none;
        margin-top: 15px;
      }
    </style>
  </head>
  <body>
    <div class="card">
      <div class="logo-container">
        <img src="/logo.png" alt="Zenith Logo" class="app-logo" />
      </div>

      <p
        style="
          font-size: 14px;
          text-align: center;
          margin-bottom: 20px;
          color: #8b949e;
        "
      >
        Asynchronous Enterprise PDF Engine
      </p>

      <button
        class="upload-zone"
        id="dropZone"
        ondrop="handleDrop(event)"
        ondragover="allowDrop(event)"
        onkeypress="onkeypress"
        onclick="document.getElementById('fileIn').click()"
      >
        <div id="fileTxt">Drop Project ZIP Here</div>
        <input type="file" id="fileIn" hidden accept=".zip" />
      </button>

      <button id="convertBtn" disabled>Start Conversion</button>

      <div class="progress-box" id="pBox">
        <div class="bar-outer"><div class="bar-inner" id="bar"></div></div>
        <div id="status" style="margin-top: 10px; font-size: 13px">
          Initializing...
        </div>
        <div class="console" id="console"></div>
        <a id="downloadBtn" href="#" download
          ><button>Download PDF Now</button></a
        >
      </div>
    </div>

    <script>
      const fileIn = document.getElementById("fileIn");
      const convertBtn = document.getElementById("convertBtn");
      const consoleBox = document.getElementById("console");
      const bar = document.getElementById("bar");
      const status = document.getElementById("status");

      fileIn.onchange = () => {
        if (fileIn.files[0]) {
          document.getElementById("fileTxt").innerText = fileIn.files[0].name;
          convertBtn.disabled = false;
        }
      };

      convertBtn.onclick = async () => {
        convertBtn.disabled = true;
        document.getElementById("pBox").style.display = "block";

        const fd = new FormData();
        fd.append("zipfile", fileIn.files[0]);
        fd.append("filters", "node_modules,.git,dist,.venv");

        const res = await fetch("/convert", { method: "POST", body: fd });
        const { jobId } = await res.json();

        // Connect to real-time logs
        const es = new EventSource(`/progress/${jobId}`);
        es.onmessage = (e) => {
          const data = JSON.parse(e.data);
          bar.style.width = data.percent + "%";
          status.innerText = data.percent + "% Complete";

          // Update Console
          const log = document.createElement("div");
          log.innerText = `> ${data.message}`;
          consoleBox.appendChild(log);
          consoleBox.scrollTop = consoleBox.scrollHeight;

          if (data.status === "completed") {
            es.close();
            document.getElementById("downloadBtn").style.display = "block";
            document.getElementById("downloadBtn").href = data.downloadUrl;
          }
          if (data.status === "failed") {
            es.close();
            alert("Conversion Failed. Check server RAM.");
          }
        };
      };
    </script>
  </body>
</html>
